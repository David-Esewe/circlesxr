<html>
  <head>
    <meta charset="utf-8">

    <!-- circles_HEADER_SCRIPTS -->
    <circles-start-scripts/>

    <script src="/worlds/hub/scripts/fire.js"></script>
    <script src="/worlds/hub/scripts/hub.js"></script>
    <script src="/worlds/hub/scripts/generator.js"></script>
    <script src="/worlds/hub/scripts/message.js"></script>
    <script src="/src/components/aframe-keyboard.min.js"></script>
  </head>
  <body>

    <a-scene circles_properties>
      <a-assets>
        <!-- assets -->
        <img id='silhouettesMap'    src='/worlds/hub/assets/textures/Silhouettes.png' crossorigin="anonymous">
        <img id='moonMap'           src='/worlds/hub/assets/textures/moonmap.jpg' crossorigin="anonymous">
        <img id='skyMap'           src='/worlds/hub/assets/textures/TychoSkymapNASA.png' crossorigin="anonymous">

        <!-- 360 -->
        <img id='salon360'          src='/global/assets/textures/equirectangular/Salon_360.jpg' crossorigin="anonymous">
        <img id='theatre360'        src='/global/assets/textures/equirectangular/Theatre_360.jpg' crossorigin="anonymous">
        <img id='provinceHouse360'  src='/global/assets/textures/equirectangular/ProvinceHouse_360.jpg' crossorigin="anonymous">

        <a-asset-item id="enviro-gltf"    src="/worlds/hub/assets/models/hubenviro.glb" response-type="arraybuffer"></a-asset-item>
        <a-asset-item id="treeline-gltf"  src="/worlds/hub/assets/models/Treeline.glb" response-type="arraybuffer"></a-asset-item>
        <a-asset-item id="moon-gltf"      src="/worlds/hub/assets/models/moon.glb" response-type="arraybuffer"></a-asset-item>
        <a-asset-item id="campfire-gltf"  src="/worlds/hub/assets/models/campfire.glb" response-type="arraybuffer"></a-asset-item>

        <!-- TODO:https://github.com/aframevr/aframe/issues/2754 bug so can't use preload=auto :  -->
        <audio id="fireCrackling-snd" src="/worlds/hub/assets/audio/fire.mp3"></audio>
        <audio id="wilderness-snd" src="/worlds/hub/assets/audio/arctura_wilderness.mp3"></audio>

        <!-- templates, mixins etc. -->
        <circles-assets/>
      </a-assets>

      <a-entity id="GameManager" campfire-interactive></a-entity>

      <!-- avatar -->
      <circles-avatar/>

      <!-- fire FX -->
      <a-entity id="fireRig" position="0.0 0.0 0.0" visible="false">
        <a-entity
          id="fireParticlesSound"
          fire="particles:200;"
          position="0.0 -0.2 0.0"
          sound="src:#fireCrackling-snd; autoplay:false; loop:true; refDistance:1.0; rolloffFactor:3.0; volume:1.0; distanceModel:exponential;">
        </a-entity>

        <a-entity animation="property:position; dur:223; to:0.0 0.0 0.05; loop:true; dir:alternate; easing:easeInOutExpo">
          <a-entity position="0.0 1.5 0.0" animation="property:position; dur:163; to:0.0 1.55 0.0; loop:true; dir:alternate; easing:linear">
            <a-entity light="type: point; color: #FFA200; intensity: 3.5; distance: 20.0; castShadow: true; shadowMapHeight: 256; shadowMapWidth: 256;"
                      animation="property:light.intensity; dur:293; dir:alternate; to:3.6; loop:true; easing:easeInOutExpo">
            </a-entity>
          </a-entity>
        </a-entity>

      </a-entity>

      <!-- links to desmond worlds -->
      <a-entity id="salonLink" position="-1.7 1.5 1.5" rotation="0 0 0" scale="0.0001 0.0001 0.0001" visible="true" shadow
                circles-interactive-object="neutral_opacity:1.0; hovered_opacity:1.0; clicked_opacity:1.0; neutral_scale:1.1; hovered_scale:1.13; clicked_scale:1.13;"
                geometry="primitive: sphere; radius:0.6; segmentsWidth:10; segmentsHeight:10;"
                material="src:#salon360; metalness:0.1; roughness:0.25; flatShading:true; emissive:#FFF; emissiveIntensity:0.02;"
                link="href:/rooms/explore/world/VD_1_Salon; visualAspectEnabled:false;"
                animation__fireon="property:scale; isRawProperty:true; startEvents:startFireAnim; elasticity:150; autoplay:false; delay:0; dir:normal; dur:1000; easing:easeOutElastic; loop:false; from:0.0001 0.0001 0.0001; to:0.5 0.5 0.5;"
                animation__fireoff="property:scale; isRawProperty:true; startEvents:stopFireAnim; autoplay:false; delay:0; dir:normal; dur:800; easing:easeOutExpo; loop:false; from:0.5 0.5 0.5; to:0.0001 0.0001 0.0001;">
                <a-entity text="value:Viola Desmond's Salon\n1938; align:center; width:5.0;" rotation="0 90 0" position="0 1 0"></a-entity>
      </a-entity>

      <a-entity id="theatreLink" position="-1.7 1.5 0" rotation="0 0 0" scale="0.0001 0.0001 0.0001" visible="true" shadow
                circles-interactive-object="neutral_opacity:1.0; hovered_opacity:1.0; clicked_opacity:1.0; neutral_scale:1.1; hovered_scale:1.13; clicked_scale:1.13;"
                geometry="primitive: sphere; radius:0.6; segmentsWidth:10; segmentsHeight:10;"
                material="src:#theatre360; metalness:0.1; roughness:0.25; flatShading:true; emissive:#FFF; emissiveIntensity:0.02;"
                link="href:/rooms/explore/world/VD_2_Theatre; visualAspectEnabled:false;"
                animation__fireon="property:scale; isRawProperty:true; startEvents:startFireAnim; elasticity:150; autoplay:false; delay:0; dir:normal; dur:1000; easing:easeOutElastic; loop:false; from:0.0001 0.0001 0.0001; to:0.5 0.5 0.5;"
                animation__fireoff="property:scale; isRawProperty:true; startEvents:stopFireAnim; autoplay:false; delay:0; dir:normal; dur:800; easing:easeOutExpo; loop:false; from:0.5 0.5 0.5; to:0.0001 0.0001 0.0001;">
                <a-entity text="value:Roseland Theatre\n1946; align:center; width:5.0;" rotation="0 90 0" position="0 1 0"></a-entity>
      </a-entity>

      <a-entity id="provinceHouseLink" position="-1.7 1.5 -1.5" rotation="0 0 0" scale="0.0001 0.0001 0.0001" visible="true" shadow
                circles-interactive-object="neutral_opacity:1.0; hovered_opacity:1.0; clicked_opacity:1.0; neutral_scale:1.1; hovered_scale:1.13; clicked_scale:1.13;"                
                geometry="primitive: sphere; radius:0.6; segmentsWidth:10; segmentsHeight:10;"
                material="src:#provinceHouse360; metalness:0.1; roughness:0.25; flatShading:true; emissive:#FFF; emissiveIntensity:0.02;"
                link="href:/rooms/explore/world/VD_3_ProvinceHouse; visualAspectEnabled:false;"
                animation__fireon="property:scale; isRawProperty:true; startEvents:startFireAnim; elasticity:150; autoplay:false; delay:0; dir:normal; dur:1000; easing:easeOutElastic; loop:false; from:0.0001 0.0001 0.0001; to:0.5 0.5 0.5;"
                animation__fireoff="property:scale; isRawProperty:true; startEvents:stopFireAnim; autoplay:false; delay:0; dir:normal; dur:800; easing:easeOutExpo; loop:false; from:0.5 0.5 0.5; to:0.0001 0.0001 0.0001;">
                <a-entity text="value:Nova Scotia Province House\n2010; align:center; width:5.0;" rotation="0 90 0" position="0 1 0"></a-entity>
      </a-entity>

      <a-entity id="costumeObjLink" position="-0.5 1.5 -3.5" rotation="0 0 0" scale="0.0001 0.0001 0.0001" visible="true" shadow
                circles-interactive-object="neutral_opacity:1.0; hovered_opacity:1.0; clicked_opacity:1.0; neutral_scale:1.1; hovered_scale:1.13; clicked_scale:1.13;"                
                geometry="primitive: sphere; radius:0.6; segmentsWidth:10; segmentsHeight:10;"
                material="src:#provinceHouse360; metalness:0.1; roughness:0.25; flatShading:true; emissive:#FFF; emissiveIntensity:0.02;"
                link="href:/rooms/explore/world/HH_CostumeObj_World; visualAspectEnabled:false;"
                animation__fireon="property:scale; isRawProperty:true; startEvents:startFireAnim; elasticity:150; autoplay:false; delay:0; dir:normal; dur:1000; easing:easeOutElastic; loop:false; from:0.0001 0.0001 0.0001; to:0.5 0.5 0.5;"
                animation__fireoff="property:scale; isRawProperty:true; startEvents:stopFireAnim; autoplay:false; delay:0; dir:normal; dur:800; easing:easeOutExpo; loop:false; from:0.5 0.5 0.5; to:0.0001 0.0001 0.0001;">
                <a-entity text="value:Costume Object\n2010; align:center; width:5.0; shader:custom-sdf;" rotation="0 90 0" position="0 1 0"></a-entity>
        </a-entity>
      <!-- environment -->
      <a-entity
        gltf-model="#enviro-gltf"
        shadow="receive: true; cast: true"
        ></a-entity>

      <a-entity
        id="campfire"
        class="interactive"
        gltf-model="#campfire-gltf"
        shadow="receive: true; cast: true"
        circles-interactive-object
        circles-object-label="label_text:click fire to start; label_visible:true; label_offset:1.1 0.2 0; arrow_position:left;"
        ></a-entity>

      <a-entity
        gltf-model="#treeline-gltf"
        circles-material-override="src:#silhouettesMap; side:double; alphaTest:0.99; shader:flat; opacity:1.0; transparent:true; flipTextureY:true;"
        shadow="receive:false; cast:true"
        ></a-entity>

        <!-- Message Generator -->
        <a-entity 
            id="Generator Geo" 
            class="interactive" 
            geometry="primitive:sphere; radius:0.12;" 
            circles-interactive-object 
            generator
            position=".37 1.1 4.73"
            circles-object-label="label_text:Click to create a message; label_visible:true; label_offset:-0.5 0 0; arrow_position:right;">
        </a-entity>


      <!-- Mouse input -->
      <a-entity id="mouseCursor" raycaster="objects: .collidable" cursor="rayOrigin: mouse"></a-entity>

      <!-- spawn point -->
      <a-entity id="spawnPoint" position="4.2 0.05 0.0"></a-entity>

      <!-- checkpoints -->
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="-0.05815080880348927 0.05 -1.937126652165017"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="1.773788008561061 0.05 0.8206161356897833"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="3.305904940681001 0.05 4.682832166759203"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="4.520465233075439 0.05 5.488178163884363"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="4.344989426771491 0.05 -5.155362082135504"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="6.6834997831464555 0.05 2.380999204264945"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="7.618967519355324 0.05 0.22066088724057406"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="7.097920297322295 0.05 -1.716988338696096"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="0.10819070461016445 0.05 2.1193249159737837"></a-entity>
      <a-entity class="interactive checkpoint" circles-interactive-object mixin="checkpoint" position="1.644493348926841 0.05 -1.2374451315182142"></a-entity>

      <!-- sky and lights -->
      <a-entity light="type: hemisphere; color:#0E192B; groundColor:#1D0A57; intensity: 1.2"></a-entity>
      <a-entity id="moonlight" position="11.5 8.5 -10.5" rotation="75 142 160" 
        light="type:directional; color:#0E192B; intensity:15.0; castShadow:true; penumbra:0.4; angle:60.0; shadowMapHeight:512; shadowMapWidth:512;"></a-entity>
      
      <a-entity id="moon"
        position="100.0 100.0 -100.0" rotation="47 22 7" gltf-model="#moon-gltf"
        circles-material-override="src:#moonMap; side:front; shader:flat; flipTextureY:true;"
        ></a-entity>

      <a-entity id="sky" geometry="primitive:sphere; radius:500; segmentsWidth:9; segmentsHeight:18"
              material="shader:flat; src:#skyMap; side:back; height:2048; width:2048" ></a-entity>

      <!-- sounds -->
      <!-- wilderness sounds from user https://freesound.org/people/Arctura/ here: https://freesound.org/people/Arctura/sounds/39829/ -->
      <a-entity position="15 0 0" sound="src:#wilderness-snd; autoplay:true; loop:true; refDistance: 5.0; rolloffFactor: 1.0; volume: 0.1; distanceModel:inverse;" ></a-entity>
    </a-scene>

    <!-- circles_END_SCRIPTS -->
    <circles-end-scripts/>
  </body>
</html>
